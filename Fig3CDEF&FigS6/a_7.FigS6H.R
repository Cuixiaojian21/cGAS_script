library(this.path)
setwd(this.path::this.dir())
library(ChIPseeker)
library(clusterProfiler)
library(TxDb.Hsapiens.UCSC.hg19.knownGene)
library(org.Hs.eg.db)
library(ggplot2)
library(stringr)
txdb <- TxDb.Hsapiens.UCSC.hg19.knownGene

sample_lab = "2_1_genelist.all"
gene_list_file <- paste0(sample_lab,".tsv")
ego_out_file <- paste0("3_1_ego_", sample_lab, ".tsv")
kegg_out_file <- paste0("4_1_kegg_", sample_lab, ".tsv")
ego_out_pdf <- paste0("3_1_ego_", sample_lab, ".pdf")
kegg_out_pdf <- paste0("4_1_kegg_", sample_lab, ".pdf")


data = read.csv(gene_list_file, sep='\t')
gene = data$geneId

kegg <- enrichKEGG(
  gene = gene,  #????????????????????????????????????
  keyType = 'kegg',  #kegg ??????
  organism = 'human',  #?????????oas ?????????????????????????????????????????????
  pAdjustMethod = 'fdr',  #?????? p ???????????????
  pvalueCutoff = 0.05,  #?????? p ???????????????????????????????????????????????????
  qvalueCutoff = 0.05,  #?????? q ???????????????????????????????????????????????????
)
write.table(kegg, kegg_out_file, 
            sep = '\t', 
            quote = FALSE, row.names = FALSE)

pdf(kegg_out_pdf, width = 11.69, height = 8.27)
dotplot(kegg,
        showCategory = 12,
        color = (c("pvalue")))+
  scale_y_discrete(labels = function(y) str_wrap(y, width = 40) )
dev.off()
